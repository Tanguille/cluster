---
# PowerMonitor CR: operator deploys Kepler (DaemonSet + Service) in observability namespace.
# Name must be "power-monitor" (enforced by operator).
# Applied by a separate Kustomization with dependsOn: kepler so CRDs exist first.
apiVersion: kepler.system.sustainable.computing.io/v1alpha1
kind: PowerMonitor
metadata:
  name: power-monitor
  labels:
    app.kubernetes.io/name: powermonitor
    app.kubernetes.io/instance: powermonitor
    app.kubernetes.io/part-of: kepler-operator
spec:
  kepler:
    config:
      logLevel: info
    deployment:
      # Explicit tolerations only (override operator default "tolerate all"). control-1 is
      # tainted kepler-exclude=true:NoSchedule so it won't get a pod.
      tolerations:
        - key: node-role.kubernetes.io/control-plane
          operator: Exists
          effect: NoSchedule
        - key: node-role.kubernetes.io/master
          operator: Exists
          effect: NoSchedule
