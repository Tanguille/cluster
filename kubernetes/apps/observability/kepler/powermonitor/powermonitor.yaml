---
# PowerMonitor CR: operator deploys Kepler (DaemonSet + Service) in observability namespace.
# Name must be "power-monitor" (enforced by operator).
# Applied by a separate Kustomization with dependsOn: kepler so CRDs exist first.
apiVersion: kepler.system.sustainable.computing.io/v1alpha1
kind: PowerMonitor
metadata:
  name: power-monitor
  labels:
    app.kubernetes.io/name: powermonitor
    app.kubernetes.io/instance: powermonitor
    app.kubernetes.io/part-of: kepler-operator
spec:
  kepler:
    config:
      logLevel: info
      # Fallback for nodes without RAPL (e.g. control-1 VM on TrueNAS). Kepler uses fake
      # meter only when hardware sensors are unavailable; other nodes keep using RAPL.
      additionalConfigMaps:
        - name: kepler-vm-fallback
